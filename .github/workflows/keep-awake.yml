name: Keep HuggingFace Space Awake (Private)

on:
  schedule:
    - cron: '0 */2 * * *'  # Her 2 saatte bir (00:00, 02:00, 04:00...)
  workflow_dispatch:  # Manuel tetikleme için buton

jobs:
  keep-awake:
    runs-on: ubuntu-latest
    name: Check HuggingFace Space Status
    steps:
      - name: Check Space Status via HuggingFace API
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          echo "Checking HuggingFace Space status via API..."
          response=$(curl -s -H "Authorization: Bearer $HF_TOKEN" \
            "https://huggingface.co/api/spaces/aassr/borsa-tavan-takip" | \
            jq -r '.status.state')
          echo "Space status: $response"
          if [ "$response" = "RUNNING" ]; then
            echo "✅ Space is awake and running"
          else
            echo "❌ Space is not running (Status: $response)"
            echo "Attempting to restart space..."
            restart_response=$(curl -s -X POST \
              -H "Authorization: Bearer $HF_TOKEN" \
              "https://huggingface.co/api/spaces/aassr/borsa-tavan-takip/restart")
            echo "Restart response: $restart_response"
          fi